<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Portal Atacad√£o - Vagas</title>

<!-- html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
        font-family: Arial, Helvetica, sans-serif;
        background: linear-gradient(135deg,#FFD700 0%, #FFA500 100%);
        padding: 20px;
    }

    .container {
        max-width: 960px;
        margin: 0 auto;
    }

    /* Painel de edi√ß√£o */
    .edit-panel {
        background: #f0f8ff;
        padding: 18px;
        border-radius: 10px;
        border: 2px solid #2E8B57;
        margin-bottom: 18px;
    }
    .edit-panel h3 { color: #2E8B57; margin-bottom: 12px; text-align: center; }
    .form-group { margin-bottom: 12px; }
    .form-group label { display:block; margin-bottom:6px; color:#333; font-weight:600; font-size:0.95rem; }
    .form-group input[type="text"], .form-group input[type="time"], .form-group input[type="date"] {
        width:100%; padding:8px 10px; border:1px solid #ddd; border-radius:6px; font-size:0.95rem;
    }
    .cargo-item { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
    .cargo-item input { flex:1; }
    .btn-remove { background:#ff4444; color:#fff; border:none; padding:8px 10px; border-radius:6px; cursor:pointer; }
    .btn-add { background:#2E8B57; color:#fff; border:none; padding:9px 12px; border-radius:6px; cursor:pointer; margin-top:6px; }
    .btn-update { background:#FF8C42; color:#fff; border:none; padding:10px; border-radius:6px; cursor:pointer; width:100%; margin-top:8px; }
    .btn-download { background:#28a745; color:#fff; border:none; padding:12px; border-radius:6px; cursor:pointer; width:100%; margin-top:10px; display:flex; align-items:center; justify-content:center; gap:8px; }

    #message { display:none; margin-bottom:10px; padding:10px; border-radius:6px; font-weight:600; }
    #message.success { background:#d4edda; color:#155724; border:1px solid #c3e6cb; }
    #message.error { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }

    /* √Årea de visualiza√ß√£o / impress√£o (propor√ß√£o 9:16) */
    .print-wrapper { display:flex; justify-content:center; margin-top:10px; }
    .print-container {
        background:#ffffff;
        border-radius:16px;
        overflow:hidden;
        width:720px;              /* preview com propor√ß√£o vertical */
        min-height:1280px;
        display:flex;
        flex-direction:column;
        box-shadow:0 12px 30px rgba(0,0,0,0.18);
    }

    .header-image { width:100%; height:auto; max-height:280px; object-fit:cover; display:block; }
    .content { padding:24px; display:flex; flex-direction:column; gap:18px; flex:1; }

    .description {
        text-align:center;
        color:#333;
        font-size:1.05rem;
        line-height:1.35;
    }

    .job-positions { margin-top:6px; }
    .job-item {
        background:#FF8C42; color:#fff; padding:12px 14px; border-radius:8px;
        margin-bottom:9px; font-size:1.05rem; font-weight:700; display:flex; align-items:center;
    }
    .job-item::before { content:'üë§'; margin-right:10px; font-size:1.15rem; }

    /* √Årea verde (DATA / HOR√ÅRIO / ENDERE√áO) - fonte reduzida e layout mais compacto */
    .interview-info {
        background:#2E8B57; color:#fff; padding:14px; border-radius:10px;
        display:flex; flex-direction:column; gap:8px;
    }
    .interview-date {
        text-align:center;
        font-size:1.0rem;       /* reduzido */
        font-weight:700;
        line-height:1.25;
    }
    .interview-location {
        font-size:0.95rem;      /* reduzido */
        line-height:1.25;
    }
    .interview-location strong { display:block; margin-bottom:6px; font-size:1.0rem; }

    .footer-image { width:100%; height:auto; max-height:160px; object-fit:contain; display:block; margin-top:auto; }

    /* Loading overlay */
    .loading-overlay {
        position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:9999;
    }
    .loading-box { background:#fff; padding:18px; border-radius:8px; text-align:center; width:280px; }
    .spinner { width:36px; height:36px; border:4px solid #eee; border-top:4px solid #2E8B57; border-radius:50%; animation:spin 1s linear infinite; margin:8px auto 6px; }
    @keyframes spin { to { transform:rotate(360deg); } }

    /* Modal do calend√°rio */
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); align-items:center; justify-content:center; z-index:1500; }
    .modal-card { background:#fff; padding:18px; border-radius:10px; width:320px; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.2); }
    .modal-card h3 { margin-bottom:10px; font-size:1.05rem; }
    .modal-actions { display:flex; gap:8px; margin-top:12px; justify-content:center; }
    .btn-modal { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; font-weight:600; }
    .btn-confirm { background:#2E8B57; color:#fff; }
    .btn-cancel { background:#ccc; color:#333; }

    /* Responsivo */
    @media(max-width:820px){
        .print-container { width:100%; min-height:auto; border-radius:12px; }
        .container { padding:0 10px; }
    }
</style>
</head>
<body>

<div class="container">

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-box">
            <div class="spinner"></div>
            <div>Gerando imagem em alta qualidade...</div>
        </div>
    </div>

    <!-- Painel de edi√ß√£o -->
    <div class="edit-panel">
        <h3>üîß Painel de Edi√ß√£o</h3>

        <div id="message" class="success" style="display:none;"></div>

        <form id="editForm">
            <div class="form-group">
                <label>Cargos Dispon√≠veis:</label>
                <div id="cargos-container">
                    <div class="cargo-item">
                        <input type="text" name="cargos[]" value="Operador de cart√£o" placeholder="Nome do cargo">
                        <button type="button" class="btn-remove" onclick="removeCargo(this)">Remover</button>
                    </div>
                    <div class="cargo-item">
                        <input type="text" name="cargos[]" value="Repositor de loja" placeholder="Nome do cargo">
                        <button type="button" class="btn-remove" onclick="removeCargo(this)">Remover</button>
                    </div>
                    <div class="cargo-item">
                        <input type="text" name="cargos[]" value="Auxiliar de Cozinha" placeholder="Nome do cargo">
                        <button type="button" class="btn-remove" onclick="removeCargo(this)">Remover</button>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addCargo()">+ Adicionar Cargo</button>
            </div>

            <div class="form-group" style="display:flex;gap:8px;">
                <div style="flex:1;">
                    <label>Data da Entrevista:</label>
                    <!-- readonly para abrir o modal -->
                    <input type="text" id="data_entrevista" placeholder="Clique para selecionar a data" readonly value="14/07/2025">
                </div>
                <div style="width:140px;">
                    <label>Hor√°rio:</label>
                    <!-- time para abrir seletor nativo -->
                    <input type="time" id="horario_entrevista" value="09:00">
                </div>
            </div>

            <button type="submit" class="btn-update">Atualizar An√∫ncio</button>
            <button type="button" class="btn-download" id="downloadBtn" onclick="downloadAsJPG()">
                üì• Baixar como JPG (Alta Qualidade)
            </button>
        </form>
    </div>

    <!-- Visualiza√ß√£o -->
    <div class="print-wrapper">
        <div class="print-container" id="capture-content">
            <img src="header.jpg" alt="Cabe√ßalho Atacad√£o" class="header-image">

            <div class="content">
                <div class="description">
                    O maior atacadista do Brasil n√£o para de crescer e quer profissionais dedicados para ajudar a contribuir com essa conquista.
                </div>

                <div id="job-positions" class="job-positions">
                    <div class="job-item">Operador de cart√£o</div>
                    <div class="job-item">Repositor de loja</div>
                    <div class="job-item">Auxiliar de Cozinha</div>
                </div>

                <div class="interview-info">
                    <div class="interview-date">
                        Entrevista dia <span id="display-data">14/07/2025</span> √†s <span id="display-horario">09:00hs</span>
                    </div>
                    <div class="interview-location">
                        <strong>ATACAD√ÉO - SOBRADINHO</strong>
                        END: AV AE 2 PARA INDUSTRIA LT 7 SOBRADINHO<br>
                        BRAS√çLIA - DF
                    </div>
                </div>
            </div>

            <img src="footer.jpg" alt="Rodap√© Atacad√£o" class="footer-image">
        </div>
    </div>
</div>

<!-- Modal do calend√°rio -->
<div class="modal" id="dateModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true">
        <h3>Escolha a data</h3>
        <input type="date" id="modalDatePicker" style="padding:10px;font-size:1rem;border-radius:6px;border:1px solid #ddd;width:100%;">
        <div class="modal-actions">
            <button class="btn-modal btn-cancel" id="modalCancel">Cancelar</button>
            <button class="btn-modal btn-confirm" id="modalConfirm">Confirmar</button>
        </div>
    </div>
</div>

<script>
/* ---------- Manipula√ß√£o de cargos ---------- */
function addCargo(){
    const container = document.getElementById('cargos-container');
    const cargoItem = document.createElement('div');
    cargoItem.className = 'cargo-item';
    cargoItem.innerHTML = `
        <input type="text" name="cargos[]" placeholder="Nome do cargo">
        <button type="button" class="btn-remove" onclick="removeCargo(this)">Remover</button>
    `;
    container.appendChild(cargoItem);
}
function removeCargo(btn){
    const container = document.getElementById('cargos-container');
    if(container.children.length > 1) btn.parentElement.remove();
    else alert('Deve haver pelo menos um cargo dispon√≠vel.');
}

/* ---------- Atualizar an√∫ncio (preenchimento do preview) ---------- */
function updateAnnouncement(){
    // cargos
    const cargosInputs = document.querySelectorAll('input[name="cargos[]"]');
    const jobPositions = document.getElementById('job-positions');
    jobPositions.innerHTML = '';
    cargosInputs.forEach(input => {
        if(input.value.trim()){
            const jobItem = document.createElement('div');
            jobItem.className = 'job-item';
            jobItem.textContent = input.value.trim();
            jobPositions.appendChild(jobItem);
        }
    });

    // data e hor√°rio
    const dataInput = document.getElementById('data_entrevista').value;
    const horarioInput = document.getElementById('horario_entrevista').value;
    document.getElementById('display-data').textContent = dataInput || '--/--/----';
    document.getElementById('display-horario').textContent = horarioInput ? horarioInput + 'hs' : '--:--';

    // mensagem sucesso
    const message = document.getElementById('message');
    message.className = 'success';
    message.style.display = 'block';
    message.textContent = 'An√∫ncio atualizado com sucesso!';
    setTimeout(()=>{ message.style.display = 'none'; }, 3000);
}

/* Form submit */
document.getElementById('editForm').addEventListener('submit', function(e){
    e.preventDefault();
    // valida pelo menos um cargo preenchido
    const cargos = document.querySelectorAll('input[name="cargos[]"]');
    let ok = false;
    cargos.forEach(i=>{ if(i.value.trim()!=='') ok = true; });
    if(!ok) { alert('Por favor, preencha pelo menos um cargo.'); return false; }
    updateAnnouncement();
});

/* Atualizar hor√°rio ao alterar o input time */
document.getElementById('horario_entrevista').addEventListener('input', function(){
    const v = this.value;
    document.getElementById('display-horario').textContent = v ? v + 'hs' : '--:--';
});

/* ---------- Modal de sele√ß√£o de data ---------- */
const dateInputField = document.getElementById('data_entrevista');
const dateModal = document.getElementById('dateModal');
const modalDatePicker = document.getElementById('modalDatePicker');
const modalCancel = document.getElementById('modalCancel');
const modalConfirm = document.getElementById('modalConfirm');

function ddmmyyyyToIso(value){
    // recebe 'DD/MM/YYYY' retorna 'YYYY-MM-DD'
    if(!value) return '';
    const parts = value.split('/');
    if(parts.length !== 3) return '';
    return `${parts[2]}-${parts[1].padStart(2,'0')}-${parts[0].padStart(2,'0')}`;
}
function isoToDdMmYyyy(value){
    // recebe 'YYYY-MM-DD' retorna 'DD/MM/YYYY'
    if(!value) return '';
    const parts = value.split('-');
    if(parts.length !== 3) return '';
    return `${parts[2].padStart(2,'0')}/${parts[1].padStart(2,'0')}/${parts[0]}`;
}

dateInputField.addEventListener('click', () => {
    // preenche o datepicker com o valor atual, se houver
    const current = dateInputField.value;
    if(current){
        modalDatePicker.value = ddmmyyyyToIso(current);
    } else {
        // default hoje
        const today = new Date();
        modalDatePicker.value = today.toISOString().split('T')[0];
    }
    dateModal.style.display = 'flex';
    modalDatePicker.focus();
});

// cancelar
modalCancel.addEventListener('click', () => {
    dateModal.style.display = 'none';
});

// confirmar
modalConfirm.addEventListener('click', () => {
    const iso = modalDatePicker.value;
    if(!iso){ alert('Escolha uma data antes de confirmar.'); return; }
    const formatted = isoToDdMmYyyy(iso);
    dateInputField.value = formatted;
    document.getElementById('display-data').textContent = formatted;
    dateModal.style.display = 'none';
});

/* fechar modal ao clicar fora */
window.addEventListener('click', (e) => {
    if(e.target === dateModal) dateModal.style.display = 'none';
});
window.addEventListener('keydown', (e) => {
    if(e.key === 'Escape') dateModal.style.display = 'none';
});

/* ---------- Download como JPG 1080x1920 (mantendo propor√ß√£o) ---------- */
async function downloadAsJPG(){
    const loadingOverlay = document.getElementById('loadingOverlay');
    const downloadBtn = document.getElementById('downloadBtn');
    const element = document.getElementById('capture-content');

    try{
        loadingOverlay.style.display = 'flex';
        downloadBtn.disabled = true;
        downloadBtn.textContent = 'Gerando...';

        // deixe a UI atualizar
        await new Promise(r => setTimeout(r, 120));

        // captura em alta resolu√ß√£o (scale maior para melhor nitidez)
        const canvasOriginal = await html2canvas(element, {
            scale: 3,
            useCORS: true,
            backgroundColor: '#ffffff',
            logging: false,
            windowWidth: document.documentElement.clientWidth,
            windowHeight: document.documentElement.clientHeight
        });

        // Canvas final para status (1080 x 1920)
        const finalCanvas = document.createElement('canvas');
        finalCanvas.width = 1080;
        finalCanvas.height = 1920;
        const ctx = finalCanvas.getContext('2d');

        // Propor√ß√£o ‚Äî mant√©m conte√∫do sem distorcer (centraliza)
        const scale = Math.min(finalCanvas.width / canvasOriginal.width, finalCanvas.height / canvasOriginal.height);
        const drawWidth = canvasOriginal.width * scale;
        const drawHeight = canvasOriginal.height * scale;
        const dx = (finalCanvas.width - drawWidth) / 2;
        const dy = (finalCanvas.height - drawHeight) / 2;

        // fundo branco
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0,0,finalCanvas.width, finalCanvas.height);

        ctx.drawImage(canvasOriginal, 0, 0, canvasOriginal.width, canvasOriginal.height, dx, dy, drawWidth, drawHeight);

        // export
        const dataURL = finalCanvas.toDataURL('image/jpeg', 0.95);

        // download autom√°tico
        const link = document.createElement('a');
        const dateStr = new Date().toISOString().split('T')[0];
        link.download = `atacadao-vagas-${dateStr}.jpg`;
        link.href = dataURL;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } catch(err){
        console.error('Erro ao gerar imagem:', err);
        alert('Erro ao gerar a imagem. Veja o console do navegador para mais detalhes.');
    } finally {
        loadingOverlay.style.display = 'none';
        downloadBtn.disabled = false;
        downloadBtn.innerHTML = 'üì• Baixar como JPG (Alta Qualidade)';
    }
}

/* Checagem html2canvas */
window.addEventListener('load', () => {
    if(typeof html2canvas === 'undefined'){
        console.error('html2canvas n√£o carregado!');
        const btn = document.getElementById('downloadBtn');
        btn.disabled = true;
        btn.textContent = '‚ùå Biblioteca ausente';
    }
});
</script>

</body>
</html>